<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>CLAUDE.md ‚Ä¢ blueskynet</title><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="CLAUDE.md"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">blueskynet</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/lassehjorthmadsen/blueskynet/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-title-body">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>CLAUDE.md</h1>
      <small class="dont-index">Source: <a href="https://github.com/lassehjorthmadsen/blueskynet/blob/main/CLAUDE.md" class="external-link"><code>CLAUDE.md</code></a></small>
    </div>

<div id="claudemd" class="section level1">

<p>This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.</p>
<div class="section level2">
<h2 id="project-overview">Project Overview<a class="anchor" aria-label="anchor" href="#project-overview"></a></h2>
<p><code>blueskynet</code> is an R package for generating and analyzing social networks from Bluesky Social. The package provides tools to build networks based on user follows relationships, analyze network structures, and visualize networks with interactive 3D widgets.</p>
</div>
<div class="section level2">
<h2 id="package-development-commands">Package Development Commands<a class="anchor" aria-label="anchor" href="#package-development-commands"></a></h2>
<div class="section level3">
<h3 id="essential-development-workflow">Essential Development Workflow<a class="anchor" aria-label="anchor" href="#essential-development-workflow"></a></h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load the package for development</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">load_all</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generate documentation from roxygen comments</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">document</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check package for CRAN compliance</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">check</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Install the package locally</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Build package documentation website</span></span>
<span><span class="fu">pkgdown</span><span class="fu">::</span><span class="fu"><a href="https://pkgdown.r-lib.org/reference/build_site.html" class="external-link">build_site</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="authentication-setup">Authentication Setup<a class="anchor" aria-label="anchor" href="#authentication-setup"></a></h3>
<p>Users must create a Bluesky app password and set environment variables:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Set environment variables in ~/.Renviron</span></span>
<span><span class="va">BLUESKY_APP_PASS</span><span class="op">=</span><span class="va">your_app_password</span></span>
<span><span class="va">BLUESKY_APP_USER</span><span class="op">=</span><span class="va">your.handle.bsky.social</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="code-architecture">Code Architecture<a class="anchor" aria-label="anchor" href="#code-architecture"></a></h2>
<div class="section level3">
<h3 id="core-module-structure">Core Module Structure<a class="anchor" aria-label="anchor" href="#core-module-structure"></a></h3>
<p>The package is organized into four main R files:</p>
<ol style="list-style-type: decimal"><li>
<strong><code>R/wrappers.R</code></strong> - Direct API wrapper functions for Bluesky endpoints:
<ul><li>
<code><a href="reference/get_token.html">get_token()</a></code> - Authentication</li>
<li>
<code><a href="reference/get_profiles.html">get_profiles()</a></code> - User profile data</li>
<li>
<code><a href="reference/get_follows.html">get_follows()</a></code> - Following relationships</li>
<li>
<code><a href="reference/get_user_posts.html">get_user_posts()</a></code> - User post data</li>
<li>
<code><a href="reference/follow_actor.html">follow_actor()</a></code> - Follow users programmatically</li>
</ul></li>
<li>
<strong><code>R/algos.R</code></strong> - Network building and analysis algorithms:
<ul><li>
<code><a href="reference/init_net.html">init_net()</a></code> - Create initial network from a key actor</li>
<li>
<code><a href="reference/expand_net.html">expand_net()</a></code> - Iteratively expand network using keyword filtering</li>
<li>
<code><a href="reference/build_network.html">build_network()</a></code> - Complete network building pipeline</li>
<li>
<code><a href="reference/add_metrics.html">add_metrics()</a></code> - Add network analysis metrics</li>
<li>
<code><a href="reference/trim_net.html">trim_net()</a></code> - Filter networks by criteria</li>
</ul></li>
<li>
<strong><code>R/helpers.R</code></strong> - Internal utility functions:
<ul><li>
<code>resp2df()</code> - Convert API responses to data frames</li>
<li>
<code>post2df()</code> - Parse post data from API responses</li>
<li>
<code>check_wait()</code> - Handle API rate limiting</li>
<li>Token refresh and validation helpers</li>
</ul></li>
<li>
<strong><code>R/blueskynet-package.R</code></strong> - Package documentation and imports</li>
</ol></div>
<div class="section level3">
<h3 id="key-architectural-patterns">Key Architectural Patterns<a class="anchor" aria-label="anchor" href="#key-architectural-patterns"></a></h3>
<p><strong>API Token Management</strong>: The package handles Bluesky authentication with access tokens and refresh tokens. All API functions expect a valid token parameter and some can refresh tokens automatically during long-running operations.</p>
<p><strong>Network Data Structure</strong>: Networks are represented as tibbles with two key columns: - <code>actor_handle</code> - The user who is following - <code>follows_handle</code> - The user being followed</p>
<p><strong>Iterative Network Expansion</strong>: The <code><a href="reference/expand_net.html">expand_net()</a></code> function uses a threshold-based approach to grow networks iteratively, filtering new candidates by keyword matching in user profiles and minimum follower counts.</p>
<p><strong>Rate Limiting</strong>: The package includes built-in handling for Bluesky API rate limits with automatic waiting and token refresh capabilities.</p>
</div>
</div>
<div class="section level2">
<h2 id="development-workflow">Development Workflow<a class="anchor" aria-label="anchor" href="#development-workflow"></a></h2>
<div class="section level3">
<h3 id="testing-strategy">Testing Strategy<a class="anchor" aria-label="anchor" href="#testing-strategy"></a></h3>
<p>The package includes comprehensive unit tests using <code>testthat</code>:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Run all tests</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">test</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run tests with coverage</span></span>
<span><span class="fu">covr</span><span class="fu">::</span><span class="fu">package_coverage</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><strong>Key Testing Principles:</strong> - <strong>71 comprehensive tests</strong> covering all major functionality - <strong>Mock data approach</strong> for API functions (avoid live API calls in tests) - <strong>Edge case coverage</strong> including Unicode text, empty inputs, large datasets - <strong>Input validation tests</strong> for proper parameter checking - <strong>Performance tests</strong> for medium-sized networks</p>
<p><strong>Test Organization:</strong> - <code>tests/testthat/test-helpers.R</code> - Utility functions (<code>word_freqs</code>, etc.) - <code>tests/testthat/test-network-analysis.R</code> - Network algorithms - <code>tests/testthat/test-api-input-validation.R</code> - API wrapper validation - <code>tests/testthat/test-edge-cases.R</code> - Edge cases and performance</p>
</div>
<div class="section level3">
<h3 id="cran-preparation-checklist">CRAN Preparation Checklist<a class="anchor" aria-label="anchor" href="#cran-preparation-checklist"></a></h3>
<p>Achievement: <strong>0 errors, 0 warnings</strong> in R CMD check</p>
<p><strong>Critical Issues to Watch:</strong> 1. <strong>Documentation formatting</strong> - Use single backslashes in roxygen (<code>\describe{}</code> not <code>\\describe{}</code>) 2. <strong>Examples strategy</strong> - Wrap API-dependent examples in <code>\dontrun{}</code> 3. <strong>Function exports</strong> - Ensure all documented functions are exported 4. <strong>Dependencies</strong> - All used packages must be in DESCRIPTION Imports 5. <strong>ORCID placeholders</strong> - Remove or replace placeholder ORCID IDs</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Key CRAN checks</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">check</span><span class="op">(</span>args <span class="op">=</span> <span class="st">"--as-cran"</span><span class="op">)</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">check_win_devel</span><span class="op">(</span><span class="op">)</span>  <span class="co"># Optional: check on Windows</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="testing-and-validation">Testing and Validation<a class="anchor" aria-label="anchor" href="#testing-and-validation"></a></h3>
<p>The package uses the <code>dev/</code> directory for development scripts and example data: - <code>dev/demo.R</code> - Complete usage examples - <code>dev/net/</code> - Sample network data files - Development scripts for stress testing and error handling</p>
</div>
<div class="section level3">
<h3 id="documentation-generation">Documentation Generation<a class="anchor" aria-label="anchor" href="#documentation-generation"></a></h3>
<ul><li>Uses roxygen2 for function documentation</li>
<li>pkgdown website generation configured in <code>_pkgdown.yml</code>
</li>
<li>Functions are categorized into ‚ÄúWrapper functions‚Äù and ‚ÄúNetwork functions‚Äù</li>
</ul></div>
<div class="section level3">
<h3 id="package-dependencies">Package Dependencies<a class="anchor" aria-label="anchor" href="#package-dependencies"></a></h3>
<p>Key dependencies include: - <code>httr2</code> for API communication - <code>dplyr</code>, <code>purrr</code> for data manipulation - <code>igraph</code>, <code>tidygraph</code> for network analysis - <code>threejs</code> for 3D network visualization - <code>quanteda</code> for text analysis of user profiles</p>
</div>
</div>
<div class="section level2">
<h2 id="common-operations">Common Operations<a class="anchor" aria-label="anchor" href="#common-operations"></a></h2>
<div class="section level3">
<h3 id="building-a-network">Building a Network<a class="anchor" aria-label="anchor" href="#building-a-network"></a></h3>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Authenticate</span></span>
<span><span class="va">auth_object</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/get_token.html">get_token</a></span><span class="op">(</span><span class="va">identifier</span>, <span class="va">password</span><span class="op">)</span></span>
<span><span class="va">token</span> <span class="op">&lt;-</span> <span class="va">auth_object</span><span class="op">$</span><span class="va">accessJwt</span></span>
<span></span>
<span><span class="co"># Create initial network</span></span>
<span><span class="va">key_actor</span> <span class="op">&lt;-</span> <span class="st">"example.bsky.social"</span></span>
<span><span class="va">keywords</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"researcher"</span>, <span class="st">"scientist"</span><span class="op">)</span></span>
<span><span class="va">net</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/init_net.html">init_net</a></span><span class="op">(</span><span class="va">key_actor</span>, <span class="va">keywords</span>, <span class="va">token</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Expand network iteratively</span></span>
<span><span class="va">expanded</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/expand_net.html">expand_net</a></span><span class="op">(</span><span class="va">net</span>, <span class="va">keywords</span>, <span class="va">token</span>, <span class="va">refresh_tok</span>,</span>
<span>                      threshold <span class="op">=</span> <span class="fl">30</span>, max_iterations <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="token-management">Token Management<a class="anchor" aria-label="anchor" href="#token-management"></a></h3>
<p>Always handle token refresh in long-running operations:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Check token validity</span></span>
<span><span class="fu"><a href="reference/verify_token.html">verify_token</a></span><span class="op">(</span><span class="va">token</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Refresh if needed</span></span>
<span><span class="va">new_auth</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/refresh_token.html">refresh_token</a></span><span class="op">(</span><span class="va">refresh_tok</span><span class="op">)</span></span>
<span><span class="va">token</span> <span class="op">&lt;-</span> <span class="va">new_auth</span><span class="op">$</span><span class="va">accessJwt</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="technical-insights--code-quality">Technical Insights &amp; Code Quality<a class="anchor" aria-label="anchor" href="#technical-insights--code-quality"></a></h2>
<div class="section level3">
<h3 id="key-function-improvements-made">Key Function Improvements Made<a class="anchor" aria-label="anchor" href="#key-function-improvements-made"></a></h3>
<p>During development, several functions were enhanced for robustness:</p>
<p><strong><code><a href="reference/extract_follow_subjects.html">extract_follow_subjects()</a></code> Enhancement:</strong></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Before: Used sapply() which could return different types</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">follow_records</span>, <span class="kw">function</span><span class="op">(</span><span class="va">record</span><span class="op">)</span> <span class="va">record</span><span class="op">$</span><span class="va">value</span><span class="op">$</span><span class="va">subject</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># After: Use vapply() for type safety</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">vapply</a></span><span class="op">(</span><span class="va">follow_records</span>, <span class="kw">function</span><span class="op">(</span><span class="va">record</span><span class="op">)</span> <span class="va">record</span><span class="op">$</span><span class="va">value</span><span class="op">$</span><span class="va">subject</span>, <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><strong>Input Validation Pattern:</strong></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Always validate inputs early in functions</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">follow_records</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"follow_records cannot be NULL"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">follow_records</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="documentation-best-practices">Documentation Best Practices<a class="anchor" aria-label="anchor" href="#documentation-best-practices"></a></h3>
<p><strong>Roxygen2 Guidelines:</strong> - Use single backslashes: <code>\describe{}</code>, <code>\item{}</code>, <code>\code{}</code> - Wrap API examples in <code>\dontrun{}</code> to prevent execution during check - Include comprehensive parameter descriptions with type information - Add cross-references with <code>\seealso</code> and function families</p>
<p><strong>Example Documentation Pattern:</strong></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' @param handle Character vector. Bluesky handles (e.g., "user.bsky.social")</span></span>
<span><span class="co">#' @param token Character. Authentication token from \code{\link{get_token}}</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @return A tibble with user profile information containing:</span></span>
<span><span class="co">#' \describe{</span></span>
<span><span class="co">#'   \item{handle}{Character. User handle}</span></span>
<span><span class="co">#'   \item{displayName}{Character. Display name}</span></span>
<span><span class="co">#'   \item{description}{Character. Profile bio}</span></span>
<span><span class="co">#' }</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @examples</span></span>
<span><span class="co">#' \dontrun{</span></span>
<span><span class="co">#' auth &lt;- get_token("your.handle.bsky.social", "your-app-password")</span></span>
<span><span class="co">#' profiles &lt;- get_profiles("example.bsky.social", auth$accessJwt)</span></span>
<span><span class="co">#' }</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="git-workflow-patterns">Git Workflow Patterns<a class="anchor" aria-label="anchor" href="#git-workflow-patterns"></a></h3>
<p><strong>Commit Message Template:</strong></p>
<pre><code>action: brief description

- Specific change 1 with technical details
- Specific change 2 with impact explanation
- Achievement metrics (e.g., "Package now passes R CMD check")

ü§ñ Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude &lt;noreply@anthropic.com&gt;</code></pre>
</div>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Lasse Hjorth Madsen.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

